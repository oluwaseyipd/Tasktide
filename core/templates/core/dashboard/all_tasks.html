{% extends "core/dashboard_layout.html" %} {% load static %} {% block content %}

<!-- All Tasks Page -->
<div class="mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="fade-in">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-900">All Tasks</h2>
      <a
        href="{% url 'create_tasks' %}"
        class="btn cursor-pointer text-white px-6 py-3 rounded-lg font-medium"
      >
        <i class="fas fa-plus mr-2"></i>
        Add New Task
      </a>
    </div>

    <div
      class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"
    >
      <div class="p-6 border-b border-gray-200">
        <div
          class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0"
        >
          <div class="flex items-center space-x-4">
            <div class="relative">
              <input
                type="text"
                placeholder="Search tasks..."
                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-claude-500 focus:border-transparent w-64"
              />
              <i
                class="fas fa-search absolute left-3 top-2.5 w-4 h-4 text-gray-400"
              ></i>
            </div>
            <select
              class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-claude-500"
            >
              <option>All Status</option>
              <option>Completed</option>
              <option>In Progress</option>
              <option>Overdue</option>
            </select>
          </div>
          <div class="text-sm text-gray-600">Showing {{ tasks.count }} tasks</div>
        </div>
      </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
      <div class="divide-y divide-gray-200">

        {% for task in tasks %}
        <div 
        class="task-card p-6 hover:bg-gray-50 transition-all duration-200">
          <div class="flex items-center justify-between">
            <a 
        href="{% url 'single_task' task.id %}" 
            class="flex items-center space-x-4">
              <input type="checkbox" checked
                class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded" />
              <div class="flex-1">
                <h3 class="text-lg font-medium text-gray-900 line-through">
                  {{ task.title }}
                </h3>
                {% if task.description %}
                <p class="text-gray-600 mt-1">{{ task.description }}</p>
                {% endif %}
                <div class="flex items-center space-x-4 mt-2 text-sm text-gray-500">
                  <span>Completed: {{ task.updated_at|date:"M d, Y H:i" }}</span>
                </div>
              </div>
            </a>
            <div class="flex items-center space-x-3">
              <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">
                âœ… Completed
              </span>
              <div class="flex items-center space-x-2">
                <a href="{% url 'update_task' task.pk %}"
                  class="text-green-600 hover:text-green-700 p-2 rounded-lg hover:bg-green-50 transition-colors">
                  <i class="fas fa-edit w-4 h-4"></i>
                </a>
                <a href="{% url 'delete_task' task.pk %}"
                  class="text-red-600 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors">
                  <i class="fas fa-trash-alt w-4 h-4"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <p class="p-6 text-gray-500 text-center">You don't have any task. Create a new task</p>
        {% endfor %}

      </div>
    </div>
    </div>
  </div>
<!-- Pagination -->
<div class="flex justify-center mt-8">
  {% if is_paginated %}
    <nav class="inline-flex space-x-2" aria-label="Pagination">
      {% if page_obj.has_previous %}
        <a href="?page=1" class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium transition">First</a>
        <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium transition">Previous</a>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <span class="px-3 py-2 rounded-lg bg-claude-600 text-white font-bold shadow">{{ num }}</span>
        {% elif num > page_obj.number|add:-3 and num < page_obj.number|add:3 %}
          <a href="?page={{ num }}" class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-claude-100 text-gray-700 font-medium transition">{{ num }}</a>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium transition">Next</a>
        <a href="?page={{ page_obj.paginator.num_pages }}" class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium transition">Last</a>
      {% endif %}
    </nav>
  {% endif %}
</div>

</div>
<script>
function toggleTask(taskId, isChecked) {
  fetch(`/tasks/${taskId}/toggle/`, {
    method: "POST",
    headers: {
      "X-CSRFToken": getCookie("csrftoken"),
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ completed: isChecked }),
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      const taskCard = document.querySelector(`#task-${taskId}`);

      if (data.completed) {
        // Smooth fade out before removing
        taskCard.style.transition = "opacity 0.5s ease, transform 0.5s ease";
        taskCard.style.opacity = "0";
        taskCard.style.transform = "translateX(30px)";
        setTimeout(() => {
          taskCard.remove();
        }, 500); // wait until fade completes
      } else {
        // If you ever want to "uncomplete" and bring it back, you can handle that differently
        taskCard.querySelector("h3").classList.remove("line-through");
      }
    } else {
      alert("Something went wrong!");
    }
  });
}


  // Helper to get CSRF token
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.startsWith(name + "=")) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  // Apply overdue styling on page load
  document.addEventListener("DOMContentLoaded", function() {
    const cards = document.querySelectorAll(".task-card");

    cards.forEach(card => {
      const status = card.dataset.status;
      const dueDate = new Date(card.dataset.dueDate);
      const today = new Date();

      if (status === "incomplete" && dueDate < today) {
        card.style.borderColor = "red";  // highlight overdue task
      }
    });
  });

function playPop() {
  const popSound = document.getElementById("pop-sound");
  popSound.currentTime = 0; // restart if it's already playing
  popSound.play();
}
</script>



{% endblock %}
